<?xml version="1.0"?>
<launch>
    <env name="ROSCONSOLE_FORMAT"
         value="[${severity}][${node}:${file}:${line}]: ${message}" />
    <env name="ROSCONSOLE_CONFIG_FILE"
         value="$(dirname)/../config/rosconsole.config" />
    <arg name="arm_id"
         default="panda"
         doc="Name of the panda robot to spawn" />
    <arg name="load_gripper"
         default="true"
         doc="Should a franka hand be mounted on the flange?" />
    <arg name="gsplines_adapter"
         default="gsplines_moveit/MinimumJerkAdapter"
         doc="Gsplines addapter" />
    <arg name="initial_joint_positions"
         doc="Initial joint configuration of the panda. Specify as a list of name/value pairs in form of '-J [name-of-joint] [value-in-rad]'. Default is a 90 degree bend in the elbow"
         default="-J $(arg arm_id)_joint1 0
                -J $(arg arm_id)_joint2 -0.785398163
                -J $(arg arm_id)_joint3 0
                -J $(arg arm_id)_joint4 -2.35619449
                -J $(arg arm_id)_joint5 0
                -J $(arg arm_id)_joint6 1.57079632679
                -J $(arg arm_id)_joint7 0.785398163397
                -J $(arg arm_id)_finger_joint1 0.001
                -J $(arg arm_id)_finger_joint2 0.001" />
    <arg name="controller"
         default="position_joint_trajectory_controller"
         doc="Which example controller should be started? (One of {cartesian_impedance,model,force,joint_position,joint_velocity}_example_controller)" />
    <!-- Load gazebo -->
    <include file="$(find franka_gazebo)/launch/panda.launch">
        <arg name="arm_id"
             default="$(arg arm_id)" />
        <arg name="use_gripper"
             default="$(arg load_gripper)" />
        <arg name="initial_joint_positions"
             default="$(arg initial_joint_positions)" />
        <arg name="controller"
             default="$(arg controller)" />
    </include>
    <!-- load URDF, SRDF and joint_limits configuration -->
    <include file="$(find panda_moveit_config)/launch/planning_context.launch">
        <arg name="load_robot_description"
             value="false" />
        <arg name="load_gripper"
             value="$(arg load_gripper)" />
        <arg name="arm_id"
             value="$(arg arm_id)" />
    </include>
    <!-- OMPL + Our planner-->
    <arg name="planning_adapters"
         default="$(arg gsplines_adapter)
                default_planner_request_adapters/FixWorkspaceBounds
                default_planner_request_adapters/FixStartStateBounds
                default_planner_request_adapters/FixStartStateCollision
                default_planner_request_adapters/FixStartStatePathConstraints" />
    <group ns="move_group/planning_pipelines">
        <include file="$(find panda_moveit_config)/launch/planning_pipeline.launch.xml"
                 pass_all_args="true">
            <arg name="pipeline"
                 value="ompl" />
        </include>
    </group>
    <!-- Trajectory Execution Functionality -->
    <arg name="transmission"
         default="position" />
    <include ns="move_group"
             file="$(find panda_moveit_config)/launch/trajectory_execution.launch.xml"
             pass_all_args="true">
        <arg name="moveit_manage_controllers"
             value="true" />
        <arg name="moveit_controller_manager"
             value="simple" />
    </include>
    <!-- Sensors Functionality -->
    <include ns="move_group"
             file="$(find panda_moveit_config)/launch/sensor_manager.launch.xml">
        <arg name="moveit_sensor_manager"
             value="panda" />
    </include>
    <!-- Start the actual move_group node/action server -->
    <node name="move_group"
          pkg="moveit_ros_move_group"
          type="move_group"
          respawn="false"
          output="screen">
        <param name="allow_trajectory_execution"
               value="true" />
        <param name="default_planning_pipeline"
               value="ompl" />
        <param name="start_state_max_bounds_error"
               value="0.1" />
        <param name="planning_scene_monitor/publish_planning_scene"
               value="true" />
        <param name="planning_scene_monitor/publish_geometry_updates"
               value="true" />
        <param name="planning_scene_monitor/publish_state_updates"
               value="true" />
        <param name="planning_scene_monitor/publish_transforms_updates"
               value="true" />
    </node>
    <!-- +++++++++++++++++++++++++++++++ -->
    <!-- launch rviz           -->
    <!-- +++++++++++++++++++++++++++++++ -->
    <node name="rviz"
          pkg="rviz"
          type="rviz"
          output="screen"
          args="-d $(find gsplines_moveit)/config/rviz_config.rviz" />
</launch>
